---
layout: post
title: "kvm"
description: ""
category: 
tags: [kvm]
---
{% include JB/setup %}

##KVM Install

####Install Tools:  
`yum -y install kvm python-virtinst libvirt  bridge-utils virt-manager qemu-kvm-tools  virt-viewer  virt-v2v`


####安装  

	virt-install --name=win2003test --ram 1024 --vcpus=1 --disk path=/mnt/win2003test.img,size=20 --accelerate --cdrom /mnt/WindowsServer2003SP2.iso --graphics vnc,password=123456,listen=0.0.0.0,port=5920 --force --autostart

####删除  

	[root@localhost ~]# virsh -c qemu:///system
	virsh # list --all
	virsh # destroy win2003Test
	virsh # undefine win2003Test

####安装过程中，在系统重启后，设置CD  

	修改 /etc/libvirt/qemu/win2003test.xml 或执行命令 virsh edit win2003test
	<source dev='/mnt/WindowsServer2003SP2.iso'/> 
	加入到
	<disk type='block' device='cdrom'>
	 <driver name='qemu' type='raw'/>
	 <source dev='/mnt/WindowsServer2003SP2.iso'/> 
	 ...
	</disk>

	然后执行一下命令  

	[root@localhost ~]# virsh -c qemu:///system
	virsh # shutdown win2003test
	virsh # destroy win2003test
	virsh # define /etc/libvirt/qemu/win2003test.xml
	virsh # start win2003test


####解决出现两个鼠标光标问题  
	修改 /etc/libvirt/qemu/win2003test.xml 或执行命令 virsh edit win2003test 
	</console>
	<input type='tablet' bus='usb'/>
	<input type='mouse' bus='ps2'/>

####安装网卡驱动  

	下载virtio-win-0.1-52.iso
	http://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/bin/virtio-win-0.1-52.iso
	修改
	<source dev='/mnt/WindowsServer2003SP2.iso'/> 
	为
	<source dev='/mnt/virtio-win-0.1-52.iso'/> 
	重启系统
	[root@localhost ~]# virsh shutdown win2003test
	[root@localhost ~]# virsh define /etc/libvirt/qemu/win2003test.xml
	[root@localhost ~]# virsh start win2003test
	进入系统后就可以从光驱安装网卡驱动了.

	[root@localhost ~]# /etc/init.d/network stop
	Shutting down interface br0:  [  OK  ]
	Shutting down interface eth0:  [  OK  ]
	Shutting down interface eth1:  [  OK  ]
	Shutting down interface eth2:  [  OK  ]
	Shutting down interface eth3:  [  OK  ]
	Shutting down interface eth4:  [  OK  ]
	Shutting down interface eth5:  [  OK  ]
	Shutting down loopback interface:  [  OK  ]

参考文章:
* [fedora 17上kvm的配置](http://blog.chinaunix.net/uid-796091-id-3291518.html)
* [CentOS 6.3部署KVM虚拟机V1.0](http://g.51cto.com/netengineer/216414)
* [Creating an RHEL 6 KVM Networked Bridge Interface](http://www.techotopia.com/index.php/Creating_an_RHEL_6_KVM_Networked_Bridge_Interface)
* [RHEL6 KVM安装备忘](http://www.cnblogs.com/kumulinux/archive/2012/12/06/2808678.html)
* [KVM Howto](http://www.linux-kvm.org/page/HOWTO)

-----

##KVM Bridge

command list:  

	[root@localhost ~]#service network stop
	[root@localhost ~]#cd /etc/sysconfig/network-scripts/
	[root@localhost ~]#cat ifcfg-eth0
		DEVICE=eth0
		ONBOOT=yes
		BRIDGE=br0
		HWADDR=b3:1c:51:ca:a9:f0

	[root@localhost ~]#cat ifcfg-br0
		DEVICE=br0   
		TYPE=Bridge 
		BOOTPROTO=static
		ONBOOT=yes 
		IPADDR=192.168.110.30
		NETMASK=255.255.255.192
		GATEWAY=192.168.110.1

	[root@localhost ~]#service network start

	[root@localhost ~]#route add default gw 192.168.110.1 dev br0

参考:  
* [linux kvm 网卡Bridge设置](http://bloodiron888.blog.163.com/blog/static/1647332712010101853023528/)
* [Redhat/CentOS6.2 x86系统KVM虚拟机网络配置(二)—Bridge方式](http://blog.csdn.net/samlei/article/details/7598541)
* [CentOS 6.0 下 KVM 网卡桥接的配置](http://bbs.chinaunix.net/thread-3591185-1-1.html)
* [虚拟化方案之－－kvm简单教程（网络桥接方案，全文更新中。。。）](http://forum.ubuntu.org.cn/viewtopic.php?t=154792)
* [RHEL KVM虚拟机网桥设置](www.anyshare.org/open/355.html)
* [Linux 原生橋接器（Bridge）](http://linuxkvm.blogspot.co.uk/2012/01/linux-bridge.html)
* [Fedora KVM Networking](http://www.net527.cn/a/Ciscomoniqi/Ciscomoniqiruanjian/2012/0524/23095.html)
* [Redhat/CentOS6.2 x86系统KVM虚拟机网络配置 Bridge方式](http://www.07net01.com/linux/Redhat_CentOS6_2_x86xitongKVMxunijiwangluopeizhi_Bridgefangshi_23477_1352279007.html)

-----

##KVM Bond
参考:  
* [What is the correct way to setup a bonded bridge on Centos 6 for KVM guests?](http://serverfault.com/questions/316623/what-is-the-correct-way-to-setup-a-bonded-bridge-on-centos-6-for-kvm-guests)
